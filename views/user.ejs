<%- include('./template/header.ejs') %>

  <div class="min-h-screen bg-gray-100 p-6">
    <div class="w-full max-w-full mx-auto bg-white shadow-2xl rounded-2xl p-8">

      <!-- Page Header -->
      <div class="flex flex-col md:flex-row items-center justify-between mb-8">
        <h1 class="text-3xl font-extrabold text-gray-800">ðŸš€ User Management</h1>
        <div class="flex gap-4 mt-4 md:mt-0">
          <!-- Create User Button -->
          <a href="/user/create_user"
            class="flex items-center gap-2 bg-gradient-to-r from-teal-400 to-cyan-500 text-white px-6 py-2 rounded-xl font-semibold shadow-md hover:scale-105 hover:shadow-lg transition">
            âž• <span>Create User</span>
          </a>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="mb-6">
        <input id="searchInput" type="text" placeholder="ðŸ” Search users..."
          class="w-full md:w-1/3 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500">
      </div>

      <!-- User List Section -->
      <div class="overflow-x-auto">
        <table id="userTable" class="w-full border-collapse bg-white rounded-xl overflow-hidden shadow text-sm">
          <thead>
            <tr class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white text-left">
              <th class="px-4 py-3">Sl No.</th>
              <th class="px-4 py-3">Name</th>
              <th class="px-4 py-3">User Name</th>
              <th class="px-4 py-3">Password</th>
              <th class="px-4 py-3">Group</th>
              <th class="px-4 py-3">Email</th>
              <th class="px-4 py-3">Phone</th>
              <th class="px-4 py-3">City</th>
              <th class="px-4 py-3">Description</th>
              <th class="px-4 py-3">Actions</th>
            </tr>
          </thead>
          <tbody class="text-gray-700">
            <% if (users.length===0) { %>
              <tr>
                <td colspan="10" class="text-center py-6 text-gray-500">
                  No users found in <%= projectName %> project.
                </td>
              </tr>
              <% } else { %>
                <% users.forEach((user, index)=> { %>
                  <tr class="border-b hover:bg-gray-50 transition" id="user-<%= user._id %>">
                    <td class="px-4 py-3">
                      <%= index + 1 %>
                    </td>
                    <td class="px-4 py-3 font-medium">
                      <%= user.name %>
                    </td>
                    <td class="px-4 py-3">
                      <%= user.username %>
                    </td>
                    <td class="px-4 py-3">
                      <%= user.password %>
                    </td>
                    <td class="px-4 py-3">
                      <% if (user.groups && user.groups.length> 0) { %>
                        <%= user.groups.map(g=> g.name).join(", ") %>
                          <% } else { %>
                            <em>â€”</em>
                            <% } %>
                    </td>
                    <td class="px-4 py-3">
                      <%= user.email %>
                    </td>
                    <td class="px-4 py-3">
                      <%= user.phone %>
                    </td>
                    <td class="px-4 py-3">
                      <%= user.city %>
                    </td>
                    <td class="px-4 py-3">
                      <%= user.description || "-" %>
                    </td>
                    <td class="px-4 py-3 flex gap-2">
                      <a href="/user/edit/<%= user._id %>"
                        class="px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                        Edit
                      </a>
                      <button onclick="deleteUser('<%= user.phone %>')"
                        class="px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                        Delete
                      </button>
                    </td>
                  </tr>
                  <% }) %>
                    <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Search function
    document.getElementById("searchInput").addEventListener("keyup", function () {
      const filter = this.value.toLowerCase();
      const rows = document.querySelectorAll("#userTable tbody tr");
      rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(filter) ? "" : "none";
      });
    });

    async function deleteUser(phoneNumber) {
      phoneNumber = phoneNumber.trim();
      try {
        const response = await fetch(`/user/delete/${encodeURIComponent(phoneNumber)}`, {
          method: "DELETE"
        });

        if (response.ok) {
          const rows = document.querySelectorAll("#userTable tbody tr");
          rows.forEach(row => {
            if (row.querySelector("td:nth-child(7)").innerText.trim() === phoneNumber) {
              row.remove();
            }
          });
          alert("User deleted successfully!");
        } else {
          const err = await response.text();
          alert("Error deleting user: " + err);
        }
      } catch (err) {
        console.error(err);
        alert("Something went wrong!");
      }
    }



  </script>

  <%- include('./template/footer.ejs') %>